# MessageAPI Definiton and Code Autogenerator

## Cheat sheet

* `npm run clean`   delete the autogenerated client.
* `npm run build`   autogenerate the client.
* `npm run build-dev`   autogenerate the client.

---

## Introduction

This folder defines both the Typescript Code Autogenerator for the OpenAPI3 model and the model itself.

OpenAPI 3 is the third major version of the OpenAPI Specification, a language-agnostic interface description for REST APIs. It is used to describe the endpoints, operations, and data types of an API in a human-readable and machine-readable format.

### Some of the benifits of using OpenAPI:

- **Automated API Generation:** OpenAPI 3 can be used to automatically generate API Clients for a variety of languages
and also as a specification for cloud API resources to know how to deploy.
- **Improved documentation:** OpenAPI 3 can be used to create comprehensive and up-to-date documentation for APIs. This
documentation can be used to understand how to use the API, and can also be used by non-technical stakeholders to understand the purpose of the API.
- **Increased collaboration:** OpenAPI 3 can be used to improve collaboration between developers and non-technical
stakeholders. By providing a common language for describing APIs, OpenAPI 3 can help to ensure that everyone
involved in the development and use of an API is on the same page.
- **Improved testing:** OpenAPI 3 can be used to create automated tests for APIs. This can help to ensure that APIs
are working as expected, and can also help to identify and fix bugs.

## Getting Started

### Prerequisites

To get started with this api, you will need to have the following items setup:

1. Software dependencies installed
    1. The current long term support version of node (18.12.0)
    1. Java version ^20 aliased to the `Java` command in terminal

## Development Process

To locally build the application you'll need to run the following commands with the project subdirectory that contains
this readme file.

    npm install # Install dependencies if not done so already
    npm dev-build # Clear any existing autogenerated resources and rebuild.

This will autogenerate code into the `{project-root}/website/src/.generated-sources/openapi` directory. And will
automatically include a README.md file with further documentation.

---

### Adding New API Call Support

To extend the OpenAPI3 API definition to include a new API call, you can follow these steps:

1. Find the path in the OpenAPI3 API definition where you want to add the new API call.
1. Add a new operation to the path. The operation should have the following properties:
   - method: The HTTP method for the new API call.
   - summary: A short summary of the new API call.
   - description: A longer description of the new API call.
   - operationId: A unique identifier for the new API call.
1. Define the request body for the new API call. The request body can be defined using a schema.
1. Define the response body for the new API call. The response body can be defined using a schema.

To build these changes such that the website code can reach it, you'll need to re-run the `npm dev-build` command.

Here is an example of how to extend the OpenAPI3 API def of `/messages` to return a MessageData object that includes
multiple messages.

    ...
    "paths": {
        ...
        "/messages": {
            "get": {
                "summary": "Get all messages",
                "description": "Gets all messages",
                "operationId": "getAllMessages",
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "$ref": "#/components/schemas/MessageDataList"
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    ...
    "components": {
        "schemas": {
            ...
            "MessageDataList": {
                "type": "object",
                "properties": {
                    "messages": {
                        "type": "array",
                        "items": {
                            "$ref": "#/components/schemas/MessageData"
                        }
                    },
                    "count": {
                        "type": "integer"
                    }
                }
            }
        }
    }

To include an entirely new path, you'll need to add a little more boilerplate to enable CORS and integrate tie the
python lambda with the path. This includes adding an `option` method for the new path in addition to the `${API_LAMBDA_URI}`
to the new method.

    ...
    "paths": {
        ...
        "/new-path": {
            "get": {
                "summary": "Get new path",
                "description": "Gets new path",
                "operationId": "getNewPath",
                "responses": {
                    "200": {
                        "description": "Success",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "type": "string"
                                }
                            }
                        }
                        ...
                    },
                    "x-amazon-apigateway-integration" : {
                        "type" : "aws_proxy",
                        "httpMethod" : "GET",
                        "uri" : "${API_LAMBDA_URI}",
                        "passthroughBehavior" : "when_no_match"
                    }
                }
            },
            ...
            "options" : {
                "responses" : {
                "204" : {
                    "description" : "204 response",
                    "headers" : {
                    "Access-Control-Allow-Origin" : {
                        "schema" : {
                        "type" : "string"
                        }
                    },
                    "Access-Control-Allow-Methods" : {
                        "schema" : {
                        "type" : "string"
                        }
                    },
                    "Access-Control-Allow-Credentials" : {
                        "schema" : {
                        "type" : "string"
                        }
                    },
                    "Access-Control-Allow-Headers" : {
                        "schema" : {
                        "type" : "string"
                        }
                    }
                    },
                    "content" : { }
                }
                },
                "x-amazon-apigateway-integration" : {
                "type" : "mock",
                "responses" : {
                    "default" : {
                    "statusCode" : "204",
                    "responseParameters" : {
                        "method.response.header.Access-Control-Allow-Credentials" : "'true'",
                        "method.response.header.Access-Control-Allow-Methods" : "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                        "method.response.header.Access-Control-Allow-Headers" : "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Amz-User-Agent'",
                        "method.response.header.Access-Control-Allow-Origin" : "'*'"
                    }
                    }
                },
                "requestTemplates" : {
                    "application/json" : "{ statusCode: 200 }"
                },
                "passthroughBehavior" : "when_no_match"
                }
            }
        }
    }
